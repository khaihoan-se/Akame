import React from 'react'
import type { GetStaticProps, NextPage } from 'next'
import Head from 'next/head'
import { ApolloClient, gql, InMemoryCache } from '@apollo/client'

const Home: NextPage = (animeList) => {
   const intialState = animeList;
   const [datas, setDatas] = React.useState(intialState)
   console.log(datas);
   
   return (
      <div>
         <Head>
            <title>Akame</title>
            <meta name="description" content="Generated by create next app" />
            {/* <link rel="icon" href="/favicon.ico" /> */}
         </Head>
         <div><a href="#">Home Page || Akame AniApi!!</a></div>
      </div>
   )
}

export const getStaticProps: GetStaticProps = async () => {
   const client = new ApolloClient({
      uri: 'https://graphql.anilist.co',
      cache: new InMemoryCache(),
   });
   const { data } = await client.query({
      query: gql`query ($id: Int, $page: Int, $perPage: Int, $search: String) {
         Page(page: $page, perPage: $perPage) {
            pageInfo {
               total
               currentPage
               lastPage
               hasNextPage
               perPage
            }
            media(type: ANIME, sort: TRENDING_DESC, id: $id, search: $search) {
               id
               idMal
               title {
                  romaji
                  english
                  native
                  userPreferred
               }
               format
               status
               episodes
               description
               startDate {
                  year
                  month
                  day
               }
               endDate {
                  year
                  month
                  day
               }
               season
               seasonYear
               duration
               countryOfOrigin
               isLicensed
               source
               hashtag
               trailer {
                  id
                  site
                  thumbnail
               }
               updatedAt
               coverImage {
                  large
                  medium
                  extraLarge
                  color
               }
               bannerImage
               genres
               synonyms
               averageScore
               meanScore
               favourites
               popularity
               trending
               tags {
                  id
                  name
                  isMediaSpoiler
               }
               relations {
                  nodes {
                     id
                     title {
                        romaji
                        english
                        native
                        userPreferred
                     }
                     type
                  }
               }
               characters {
                  nodes {
                     id
                     name {
                        first
                        middle
                        last
                        full
                        native
                        userPreferred
                     }
                  }
               }
               staff {
                  nodes {
                     id
                     name {
                        first
                        middle
                        last
                        full
                        native
                        userPreferred
                     }
                  }
               }
               studios {
                  nodes {
                     id
                     name 
                     isAnimationStudio
                  }
               }
               isFavourite
               isAdult
               isLocked
               nextAiringEpisode {
                  timeUntilAiring
                  airingAt
                  episode
               }
               airingSchedule {
                  nodes {
                     airingAt
                     timeUntilAiring
                     episode
                  }
               }
               externalLinks {
                  url
                  site
               }
               streamingEpisodes {
                  title
                  thumbnail
                  url
                  site
               }
               siteUrl
               isRecommendationBlocked
               recommendations {
                  nodes {
                     mediaRecommendation {
                        id 
                        title {
                           romaji
                           english
                           native
                           userPreferred
                        }
                        type
                     }
                  }
               }
            }
         } 
     }`
   })

   return {
      props: {
         animeList: data
      }
   }
}

export default Home
